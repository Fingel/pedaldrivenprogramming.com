---
layout: post
title: Coding Restore The Fourth
categories: code featured
featured_image: rt4.png
tags:
- ! '#restorethe4th'
- Django
- geopy
- google maps api
- Programming
- Python
- Restore The Fourth
- Snowden
status: publish
type: post
published: true
meta:
  _wpas_done_all: '1'
  _edit_last: '1'
---
Been watching the news lately? Surprise surprise, the government is collecting your data. While this may be <a href="http://www.cispaisback.org/">old news for many</a> the recent leaks by Edward Snowden have brought the issue to national attention. Now, people are shocked and angry at the fact that their online data is not as secure as they thought it was.

And rightly so, the argument can be made that the NSA is violating the forth amendment. And that is exactly what Restore The Fourth, a grass-roots movement origination from the webz, is doing. From the <a href="http://www.restorethefourth.net">website</a>:
<blockquote>Restore the Fourth is a grassroots, non-partisan movement; we believe the government of the United States must respect the right to privacy of all its citizens as the Fourth Amendment clearly states. We seek to bring awareness to the abuses against our civil liberties and the erosion of this cornerstone of our democracy.<strong>
</strong></blockquote>
I'm sympathetic with this cause. And despite most likely being placed on a government watch list for the rest of my life, I decided it would be cool to volunteer my time and help build these folks a website. The decision was made to use <a href="https://www.djangoproject.com/">Django</a>, a neat framework written in Python.

One of the coolest features of the website is the map on the front page. The locations are set by pulling objects from the database that represent protests. These objects are editable in the back end by regular admins using Django's awesome gui admin interface.

When creating a protest via the admin interface you don't need to supply a latitude/longitude pair (which are needed for google maps) but instead the backend utilizes the <a href="https://developers.google.com/maps/documentation/business/geolocation/">Google Maps Geolocation Api</a> so all that's needed is a city and/or state. To make that process easy, we're using <a href="https://code.google.com/p/geopy/">geopy</a>, a geolocation library for Python. In the Protest model, we can simply call this:
<br/><br/>
{% highlight python %}
def generateLatLong(self):
    g = geocoders.GoogleV3()
    place, (lat, lng) = g.geocode("{0} {1}".format(self.state, self.city),exactly_one=True)
    self.latitude = lat
    self.longitude = lng
{% endhighlight %}
to generate a proper latitude/longitude pair for the object, using it's city and state.

Then in our views, we make a method to serialize these objects as json:
{% highlight python %}
def protestsjson(request):
    protest_list = Protest.objects.all()
    data = serializers.serialize('json', protest_list)
    return HttpResponse(data, mimetype="application/json")
{% endhighlight %}
From there, its just a matter of telling the google map to use those objects to create markers:

{% highlight javascript %}
var map = new EventsMap();
    $.getJSON('/protests.json', function(data){
    map.plotStaticMarkers(data);
});

// plot new markers on the map, make them interactive
this.plotStaticMarkers = function(data){
    $.each(data, function (i, location) {
        var latlng = new google.maps.LatLng(location.fields.latitude, location.fields.longitude);
        var marker = new google.maps.Marker({
             map: map,
             position: latlng,
             title: location.fields.city
        });

         google.maps.event.addListener(marker, 'click', function () {
         var content = infoWindowTemplate
              .replace('{location}', location.fields.city)
              .replace('{info}', location.pk);

         infoWindow.setContent(content);
         infoWindow.open(map, marker);
         });
    })
}
{% endhighlight %}
And there we have it, a neat interactive map that doesnâ€™t require a developer's involvement to edit! And we know developers love that.

Check it out in action: <a href="http://www.restorethefourth.net">http://www.restorethefourth.net</a>

As usual, the source is available on <a href="https://github.com/AustinRiba/rtf">Github</a>
<iframe width="100" height="20" src="http://ghbtns.com/github-btn.html?user=AustinRiba&amp;repo=rtf&amp;type=fork&amp;count=true" frameborder="0" scrolling="0"></iframe>
